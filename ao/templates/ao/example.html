
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>山荘アオ</title>
<style>
    p{
        color: #800000;
        text-align: center;
        font-size: 30px;
    }
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        padding: 20px;
    }
    
    .reservation-form {
        width: 90%;
        margin: 0 auto;
        background-color: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    .form-group {
        margin-bottom: 25px;
        display: flex;
        flex-direction: column;
    }
    
    .form-group label {
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        font-size: 25px;
    }
    
    .form-group input, .form-group select, .form-group textarea {
        font-size: 30px;
        border-color: #333;
    }

    .form-check {
        margin-bottom: 20px;
    }

    /* チェックボックスのラベルとサイズ拡大 */
    .form-check label {
        font-size: 26px;     /* ラベルを大きく */
    }

    .form-check input[type="checkbox"] {
        margin-left: 30px;
        width: 30px;         /* チェックボックスの幅を拡大 */
        height: 30px;        /* 高さを拡大 */
    }
    .form-check input[type="number"] {
        margin-left: 50px;
        font-size: 20px;
        width: 100px;         /* チェックボックスの幅を拡大 */
        height: 30px;        /* 高さを拡大 */
    }

    .form-hope textarea{
        width: 100%;
        height: 200px;               /* 高さ */
        font-size: 20px;             /* フォントサイズ */
        border: 1px solid #333;      /* 枠線 */
        margin-bottom: 20px;         /* 下余白 */
        white-space: normal;         /* 自動改行 */
        word-wrap: break-word;       /* 単語内でも改行 */
        resize: none;                /* サイズ変更禁止 */
        padding: 10px;               /* 内側余白 */
    }
    .char-count {
        font-size: 16px;
        color: #555;
    }
    .warning {
        color: red;
        font-weight: bold;
    }

    .buttoms {
    display: flex;
    justify-content: center;
    gap: 20px; /* ボタン間のスペース */
    flex-wrap: wrap; /* スマホで折り返し対応 */
    margin-top: 30px;
}

.btn-primary1 {
    text-align: center;
    background-color: #007bff;
    color: #fff;
    padding: 10px 30px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 25px;
    transition: background-color 0.3s;
    min-width: 200px; /* ボタン幅を統一 */
}

.btn-primary2 {
    text-align: center;
    background-color: #800000;
    color: #fff;
    padding: 10px 30px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 25px;
    transition: background-color 0.3s;
    min-width: 200px; /* ボタン幅を統一 */
}

.btn-primary1:hover {
    background-color: #0056b3;
    text-decoration: underline;
}
.btn-primary2:hover {
    background-color: #470000;
    text-decoration: underline;
}

    a{text-decoration: none;}
    
    .btn-secondary {
        background-color: #6c757d;
        color: #fff;
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 25px;
        margin-top: 10px;
        width: 50%;
        transition: background-color 0.3s;
    }
    
    .btn-secondary:hover {
        background-color: #494b4d;
        text-decoration: underline;
    }
    .disable{
        pointer-events: none;  /* クリック無効 */
        background-color: #f1f1f1;  /* 無効感を演出 */
        opacity: 0.3;          /* 半透明で無効感を演出 */
    }
</style>

<form method="post" action="{% url 'example' %}" class="reservation-form">
    {% csrf_token %}
    <p>予約情報入力(必須)</p>
    <div class="form-group">
        <label>{{ form.check_in_date.label }}</label>
        {{ form.check_in_date }}
    </div>

    <div class="form-group">
        <label>{{ form.check_out_date.label }}</label>
        {{ form.check_out_date }}
    </div>

    <div class="form-group">
        <label>{{ form.name.label }}</label>
        {{ form.name }}
    </div>

    <div class="form-group">
        <label>{{ form.furigana.label }}</label>
        {{ form.furigana }}
    </div>

    <div class="form-group">
        <label>{{ form.men.label }}</label>
        {{ form.men }}
    </div>

    <div class="form-group">
        <label>{{ form.women.label }}</label>
        {{ form.women }}
    </div>

    <div class="form-group">
        <label>{{ form.email.label }}</label>
        {{ form.email }}
    </div>

    <div class="form-group">
        <label>{{ form.phone_number.label }}</label>
        {{ form.phone_number }}
    </div>

    <div class="form-group">
        <label>{{ form.postal_code.label }}</label>
        {{ form.postal_code }}
        <button type="button" id="search-address" class="btn-secondary">住所検索</button>
    </div>

    <div class="form-group">
        <label>{{ form.address.label }}</label>
        {{ form.address }}
    </div>

    <p>追加オプション(任意)</p>
    <div class="form-check">
        　　<label>{{ form.yakiniku.label }}</label>
        {{ form.yakiniku }}セット
    </div>
    <div class="form-check">
        　　<label>{{ form.maki.label }}</label>
        {{ form.maki }}セット
    </div>

    <div class="form-check">
        {{ form.soumen }}
        <label>{{ form.soumen.label }}</label>
    </div>

    <!--
    <div class="form-check">
        {{ form.games }}
        <label>{{ form.games.label }}</label>
    </div>

    <div class="form-check">
        {{ form.others }}
        <label>{{ form.others.label }}</label>
    </div> 
    !-->

    <p>ご要望(任意)</p>
    <div class="form-hope">
        {{form.messages}}
        <div class="char-count">
            <span id="char-count">0</span>/300 文字
        </div>
        <div id="warning" class="warning" style="display: none;">300文字まで入力可能です！</div>
    </div>

    <div class="buttoms">
        <a href="{% url 'resa' %}" class="btn-primary2">日付変更へ</a>
        <button type="submit" class="btn-primary1">予約確認へ</button>
    </div>
</form>


    
    
    <script>


    document.getElementById('search-address').addEventListener('click', function () {
        const postalCodeInput = document.querySelector('input[name="postal_code"]');
        const postalCode = postalCodeInput.value.trim();
    
        // 郵便番号の形式を検証（ハイフンなし7桁）
        if (!/^\d{7}$/.test(postalCode)) {
            alert("郵便番号はハイフン無しで入力してください（例: 1234567)");
            return;
        }
    
        // 郵便番号APIの呼び出し
        fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.results) {
                    const result = data.results[0];
                    const address = `${result.address1} ${result.address2} ${result.address3}`;
                    const addressField = document.querySelector('textarea[name="address"]') || document.querySelector('input[name="address"]');
                    if (addressField) {
                        addressField.value = address;
                    } else {
                        console.error("Address field not found in the form.");
                    }
                } else if (data.message) {
                    // APIが返すエラーメッセージを表示
                    alert(`エラー: ${data.message}`);
                } else {
                    alert("住所が見つかりませんでした。郵便番号を確認してください。");
                }
            })
            .catch(error => {
                console.error("Error fetching address:", error);
                alert("住所検索でエラーが発生しました。");
            });
    });
    


        
     // フォーム送信時のバリデーション
     document.querySelector('.reservation-form').addEventListener('submit', function (event) {
    const nameInput = document.querySelector('input[name="name"]');
    const furiganaInput = document.querySelector('input[name="furigana"]');
    const phoneInput = document.querySelector('input[name="phone_number"]');
    const menInput = document.querySelector('select[name="men"]');
    const womenInput = document.querySelector('select[name="women"]');

    const nameValue = nameInput.value.trim();
    const furiganaValue = furiganaInput.value.trim();
    const phoneValue = phoneInput.value.trim();
    const menValue = parseInt(menInput.value) || 0;
    const womenValue = parseInt(womenInput.value) || 0;

    let isValid = true;

    // 1. 氏名は漢字のみ、姓と名の間にスペースが必要
    if (!/^[\u4E00-\u9FFF]+\s[\u4E00-\u9FFF]+$/.test(nameValue)) {
        alert("氏名は漢字のみで、姓と名の間にスペースを入れてください（例: 山田 太郎）");
        isValid = false;
    }

    // 2. ふりがなはひらがなのみ、姓と名の間にスペースが必要
    if (!/^[\u3040-\u309F]+\s[\u3040-\u309F]+$/.test(furiganaValue)) {
        alert("ふりがなはひらがなのみで、姓と名の間にスペースを入れてください（例: やまだ たろう）");
        isValid = false;
    }

    // 3. 電話番号はハイフンなし、11文字
    if (!/^\d{11}$/.test(phoneValue)) {
        alert("電話番号はハイフンなしの11桁で入力してください（例: 09012345678）");
        isValid = false;
    }
    
    // 4. 合計人数が50人を超えないかチェック
    const totalPeople = menValue + womenValue;
    if (totalPeople > 50) {
        alert("合計人数は50人までとなります。現在の合計: " + totalPeople + "人");
        isValid = false;
    }
    
    // バリデーションエラーがある場合は送信停止
    if (!isValid) {
        event.preventDefault();
    }
});

    const textarea = document.getElementById("id_messages");
    const charCount = document.getElementById("char-count");
    const warning = document.getElementById("warning");

    textarea.addEventListener("input", () => {
        const length = textarea.value.length;

        // 文字数カウント表示
        charCount.textContent = length;

        // 300文字を超えた場合は警告表示
        if (length >= 300) {
            warning.style.display = "block";
        } else {
            warning.style.display = "none";
        }
    });


    </script>





